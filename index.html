<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Junk Yard â€“ ASCII Battle Royale</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin:0; padding:0; background:#000; color:#0f0; font-family: monospace; overflow:hidden;}
    #mainMenu,#shopMenu { position:absolute; top:0;left:0;width:100vw;height:100vh;
      background:#000; display:flex; align-items:center; justify-content:center; flex-direction:column;}
    .menuBox { border:2px dashed #0f0; padding:20px; margin:10px; width:70%; text-align:center; cursor:pointer;}
    #shopGrid { display:flex; flex-wrap:wrap; justify-content:center; max-width:90%; }
    .asciiSkin { border:1px solid #0f0; padding:10px; margin:5px; white-space:pre; cursor:pointer; font-size:10px; }
    #gameCanvas { display:none; background:#111; width:100vw; height:100vh; }
    #joystickOuter { position:absolute; bottom:30px; left:30px; width:120px; height:120px; background:rgba(255,255,255,0.1); border-radius:60px; display:none;}
    #joystickInner { position:absolute; width:60px; height:60px; background:rgba(0,255,0,0.5); border-radius:30px; left:30px; top:30px;}
  </style>
</head>
<body>

<div id="mainMenu">
  <h1>ðŸ§² Junk Yard â€“ ASCII Royale</h1>
  <div class="menuBox" onclick="startGame()">Start Battle Royale</div>
  <div class="menuBox" onclick="openShop()">Shop & Upgrades</div>
</div>

<div id="shopMenu" style="display:none;">
  <h2>ðŸ›’ Shop (Rust: <span id="rustDisplay">0</span>)</h2>
  <div id="shopGrid"></div>
  <div class="menuBox" onclick="saveAndBack()">Back to Menu</div>
</div>

<canvas id="gameCanvas" width="800" height="480"></canvas>
<div id="joystickOuter">
  <div id="joystickInner"></div>
</div>

<audio id="shootSnd"><source src="https://actions.google.com/sounds/v1/impacts/impact_snare.ogg" type="audio/ogg"></audio>

<script>
/* === Game Data & Storage === */
let rust = parseInt(localStorage.getItem('jrRust'))||0;
let ownedSkins = JSON.parse(localStorage.getItem('jrSkins')||'[0]');
let selectedSkin = parseInt(localStorage.getItem('jrSkin')||'0');
let gunUpgrades = JSON.parse(localStorage.getItem('jrUpgrades')||'{"damage":1,"rate":1}');
document.getElementById('rustDisplay').innerText = rust;

/* === ASCII Skins === */
const skins = [
"[ ]\n\\_/\n/|\\\n | \n/ \\",
"{_}\n/0\\\n-|-\n/ \\",
"(x)\n|#|\n/|\\\n/ \\"
];

/* === Canvas & Controls === */
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
let w=canvas.width=window.innerWidth;
let h=canvas.height=window.innerHeight;
let joystick={x:0,y:0};
let dragging=false;
const joOuter=document.getElementById('joystickOuter');
const joInner=document.getElementById('joystickInner');
const shootSnd=document.getElementById('shootSnd');

/* === Entities === */
let player={x:w/2,y:h/2,health:100,alive:true};
let bullets=[];
let bots=[];

/* === Shop UI === */
function openShop(){
  document.getElementById('mainMenu').style.display='none';
  document.getElementById('shopMenu').style.display='flex';
  let grid=document.getElementById('shopGrid');
  grid.innerHTML='';
  skins.forEach((sk,i)=>{
    let div=document.createElement('div'); div.className='asciiSkin'; div.innerText=sk;
    if(ownedSkins.includes(i)) div.style.opacity=0.5;
    div.onclick=()=>{
      if(!ownedSkins.includes(i)&&rust>=10){rust-=10; ownedSkins.push(i);}
      selectedSkin=i;
      document.getElementById('rustDisplay').innerText=rust;
      div.style.opacity=0.5;
    };
    grid.appendChild(div);
  });
}

function saveAndBack(){
  localStorage.setItem('jrRust',rust);
  localStorage.setItem('jrSkins',JSON.stringify(ownedSkins));
  localStorage.setItem('jrSkin',selectedSkin);
  localStorage.setItem('jrUpgrades',JSON.stringify(gunUpgrades));
  document.getElementById('shopMenu').style.display='none';
  document.getElementById('mainMenu').style.display='flex';
}

/* === Game Start === */
function startGame(){
  document.getElementById('mainMenu').style.display='none';
  canvas.style.display='block';
  joOuter.style.display='block';
  spawnBots(7);
  gameLoop();
}

/* === Spawning Bots === */
function spawnBots(n){
  bots=[];
  for(let i=0;i<n;i++){
    bots.push({ x:Math.random()*w, y:Math.random()*h, health:80, fireCooldown:0 });
  }
}

/* === Game Loop === */
function gameLoop(){
  ctx.clearRect(0,0,w,h);
  updatePlayer(); updateBots(); updateBullets(); drawScene();
  if(player.alive && bots.some(b=>b.health>0)) requestAnimationFrame(gameLoop);
  else { alert(player.alive?"You Win!":"You Lost!"); location.reload(); }
}

/* === Update Logic === */
function updatePlayer(){
  player.x+=joystick.x*3; player.y+=joystick.y*3;
  if(player.x<0)player.x=0; if(player.x>w)player.x=w;
  if(player.y<0)player.y=0; if(player.y>h)player.y=h;
}

function updateBots(){
  bots.forEach(bot=>{
    if(bot.health<=0)return;
    const dx=player.x-bot.x, dy=player.y-bot.y;
    const dist=Math.hypot(dx,dy);
    if(dist>20){
      bot.x+=dx/dist*0.7; bot.y+=dy/dist*0.7;
    }
    if(bot.fireCooldown<=0 && dist<200){
      bot.fireCooldown=60/gunUpgrades.rate;
      bullets.push({x:bot.x,y:bot.y,dx:dx/dist*4,dy:dy/dist*4,from:'bot',damage:5*gunUpgrades.damage});
    } else bot.fireCooldown--;
  });
}

function updateBullets(){
  bullets.forEach((b,i)=>{
    b.x+=b.dx; b.y+=b.dy;
    if(b.x<0||b.x>w||b.y<0||b.y>h) bullets.splice(i,1);
    else if(b.from==='player'){
      bots.forEach((bot,j)=>{
        if(bot.health>0 && Math.hypot(b.x-bot.x,b.y-bot.y)<15){
          bot.health-=b.damage;
          bullets.splice(i,1);
          if(bot.health<=0) rust+=20;
        }
      });
    } else {
      if(Math.hypot(b.x-player.x,b.y-player.y)<15){
        player.health-=b.damage;
        bullets.splice(i,1);
        if(player.health<=0) player.alive=false;
      }
    }
  });
}

/* === Render Scene === */
function drawScene(){
  // player
  drawASCII(skins[selectedSkin],player.x,player.y, player.alive?'lime':'gray');
  drawBar(player.x-20,player.y-40,player.health/100,'green');
  // bots
  bots.forEach(bot=>{
    if(bot.health>0){
      drawASCII("[*]\n/|\\\n/ \\",bot.x,bot.y,'red');
      drawBar(bot.x-20,bot.y-40,bot.health/80,'red');
    }
  });
  // bullets
  bullets.forEach(b=>{
    ctx.fillStyle=b.from==='player'?'cyan':'yellow';
    ctx.fillText('*',b.x,b.y);
  });
}

/* === Utilities === */
function drawASCII(ascii,x,y,color){
  ctx.fillStyle=color;
  ascii.split('\n').forEach((line,i)=>ctx.fillText(line,x,y+i*12));
}

function drawBar(x,y,pct,color){
  ctx.fillStyle='#333'; ctx.fillRect(x,y,40,6);
  ctx.fillStyle=color; ctx.fillRect(x,y,40*pct,6);
}

/* === Touch Joystick === */
joOuter.addEventListener('touchstart',e=>{dragging=true;});
joOuter.addEventListener('touchmove',e=>{
  if(!dragging)return;
  const t=e.touches[0];
  const r=joOuter.getBoundingClientRect();
  const cx=r.left+r.width/2, cy=r.top+r.height/2;
  const dx=t.clientX-cx, dy=t.clientY-cy;
  const dist=Math.min(Math.hypot(dx,dy),50), ang=Math.atan2(dy,dx);
  joystick.x=Math.cos(ang)*dist/50;
  joystick.y=Math.sin(ang)*dist/50;
  joInner.style.left=30+joystick.x*30+'px';
  joInner.style.top=30+joystick.y*30+'px';
},false);
joOuter.addEventListener('touchend',e=>{
  dragging=false; joystick.x=0; joystick.y=0;
  joInner.style.left='30px'; joInner.style.top='30px';
},false);

/* === Player Shoot on tap === */
canvas.addEventListener('touchstart',e=>{
  const fromP={x:player.x,y:player.y};
  bullets.push({x:fromP.x,y:fromP.y,dx:0,dy:-5,from:'player',damage:10*gunUpgrades.damage});
  shootSnd.currentTime=0; shootSnd.play();
},false);
</script>

</body>
</html>
